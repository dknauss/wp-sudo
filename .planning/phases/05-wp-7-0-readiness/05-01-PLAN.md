---
phase: 05-wp-7-0-readiness
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - tests/MANUAL-TESTING.md
  - docs/abilities-api-assessment.md
autonomous: true

must_haves:
  truths:
    - "MANUAL-TESTING.md has a WP 7.0 Visual Compatibility section covering settings page, challenge page, admin bar, notices, and disabled action links"
    - "Abilities API assessment document exists and covers all 3 read-only abilities, permission_callback analysis, Gate surface gap, and gating strategy for future destructive abilities"
  artifacts:
    - path: "tests/MANUAL-TESTING.md"
      provides: "Section 15: WP 7.0 Visual Compatibility with 5 subsections"
      contains: "## 15. WP 7.0 Visual Compatibility"
    - path: "docs/abilities-api-assessment.md"
      provides: "Abilities API evaluation document"
      contains: "core/get-site-info"
  key_links:
    - from: "docs/abilities-api-assessment.md"
      to: "includes/class-gate.php"
      via: "documents existing Gate surfaces and future ability gating strategy"
      pattern: "admin.*ajax.*rest.*cli.*cron.*xmlrpc"
---

<objective>
Write the two documentation deliverables for WP 7.0 readiness: (1) add WP 7.0 visual compatibility checks as section 15 of the existing manual testing guide, and (2) create the Abilities API assessment document.

Purpose: WP70-01/WP70-02 require manual testing against WP 7.0 — the test section must exist first. WP70-04 requires the Abilities API assessment document.
Output: Updated `tests/MANUAL-TESTING.md` with section 15, new `docs/abilities-api-assessment.md`
</objective>

<execution_context>
@/Users/danknauss/.claude/get-shit-done/workflows/execute-plan.md
@/Users/danknauss/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-wp-7-0-readiness/05-RESEARCH.md
@tests/MANUAL-TESTING.md
@includes/class-gate.php
@includes/class-action-registry.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add WP 7.0 Visual Compatibility section to MANUAL-TESTING.md</name>
  <files>tests/MANUAL-TESTING.md</files>
  <action>
Append a new section 15 to the end of `tests/MANUAL-TESTING.md` (after the existing section 14 "Edge Cases"). The section should be titled "## 15. WP 7.0 Visual Compatibility" and contain 5 subsections:

**15.1 Settings Page (Settings > Sudo)** — Load Settings > Sudo under WP 7.0 admin chrome. Check: form table rows/labels/selects align, policy dropdowns respect 140px min-width, shield dashicon renders in page title, help tabs open correctly, gated actions table (`.widefat.striped`) renders with correct spacing, MU-plugin status section renders.

**15.2 Challenge Page** — Trigger a gated action (e.g., Settings > General > Save Changes). Check: challenge card centered with max-width 420px, white background, border/shadow; password field fills card width; "Confirm & Continue" and "Cancel" buttons render correctly; no raw text or visible escape sequences.

**15.3 Admin Bar Countdown** — Activate a sudo session. Check: green countdown node renders in admin bar; timer text readable against green (#2e7d32) background; red state (#c62828) appears in final 60 seconds; admin bar node does not conflict with WP 7.0 toolbar chrome.

**15.4 Admin Notices (Gate Notice + Blocked Notice)** — Go to Plugins page with no sudo session. Check: `.notice.notice-warning` class applies correctly; link to challenge page is visible and styled.

**15.5 Disabled Action Links (Plugin/Theme rows)** — Go to Plugins page with no sudo session. Check: activate/deactivate/delete links replaced with gray spans; inline `color:#787c82; cursor:default` renders correctly; no conflict with new row-action hover styles from admin refresh.

Each subsection should follow the existing guide's format: numbered steps, **Expected:** block describing what to observe, and a **Result:** placeholder `[PASS/FAIL - date tested]`.

Add a brief intro paragraph: "Run against WP 7.0 beta/RC (Studio at localhost:8883 or Local at localhost:10045). Document pass/fail and any visual regressions. These checks verify the plugin's admin UI renders correctly under the WP 7.0 admin visual refresh (Trac #64308)."

Use the exact structure from the RESEARCH.md "Pattern 1: Manual Test Documentation Section" as the template.
  </action>
  <verify>
Verify section 15 exists: `grep -n "## 15. WP 7.0 Visual Compatibility" tests/MANUAL-TESTING.md` returns a match.
Verify all 5 subsections exist: `grep -c "### 15\." tests/MANUAL-TESTING.md` returns 5.
Verify no existing sections were modified: the file still has 14 prior sections.
  </verify>
  <done>MANUAL-TESTING.md has section 15 with 5 subsections covering settings page, challenge page, admin bar, notices, and disabled action links under WP 7.0 admin visual refresh.</done>
</task>

<task type="auto">
  <name>Task 2: Write Abilities API assessment document</name>
  <files>docs/abilities-api-assessment.md</files>
  <action>
Create `docs/abilities-api-assessment.md` fulfilling WP70-04. The document must cover these required sections:

1. **Header/metadata** — Date, WP version evaluated (7.0 Beta 1), status ("No gating changes required for WP 7.0").

2. **Current Abilities Surface in WP 7.0** — Table listing the 3 read-only core abilities:
   - `core/get-site-info` — "Get Site Information" — `current_user_can('read')` — Not destructive
   - `core/get-user-info` — "Get User Information" — `current_user_can('read')` — Not destructive
   - `core/get-environment-info` — "Get Environment Info" — `current_user_can('read')` — Not destructive

3. **REST endpoints** — Document the Abilities API REST routes:
   - `GET /wp-json/wp-abilities/v1/abilities` (list all)
   - `GET /wp-json/wp-abilities/v1/categories` (list categories)
   - `GET /wp-json/wp-abilities/v1/{ns}/{name}` (single ability)
   - `GET|POST|DELETE /wp-json/wp-abilities/v1/{ns}/{name}/run` (execute; method depends on ability type)

4. **Analysis: Does WP Sudo Need to Gate Abilities?** — Explain:
   - Current state: No gating required (all read-only; WP Sudo gates operations that MODIFY or DESTROY state)
   - `permission_callback` pattern vs. WP Sudo gating (capability check vs. reauthentication)
   - Current Gate surfaces: admin, ajax, rest, cli, cron, xmlrpc — no `ability` surface type

5. **Gating Strategy for Future Destructive Abilities** — When a destructive ability appears (DELETE method on `/run`):
   - The existing `rest_request_before_callbacks` intercept in Gate already covers REST routes
   - A new rule in Action_Registry matching `/wp-abilities/v1/.*/run` with DELETE method would suffice
   - No new surface type required for REST-exposed abilities
   - For WP-CLI `wp ability run`, existing CLI surface gating via function hooks applies

6. **When to Add `ability` Surface Type to Gate** — Only if abilities gain a non-REST execution path that bypasses existing surfaces (unlikely given current architecture). Document the trigger conditions.

7. **Recommendation** — No Gate changes for WP 7.0. Monitor abilities-api for destructive additions. When they appear, add REST rules to Action_Registry.

Follow the document structure from the RESEARCH.md "Pattern 2" section. Write in the same technical tone as existing docs (see `docs/security-model.md` for reference). Per CLAUDE.md verification rules, note that ability names are from research (verified against official sources in 05-RESEARCH.md), not training data — include the verification sources cited in the research.
  </action>
  <verify>
Verify file exists: `ls docs/abilities-api-assessment.md`
Verify required content: `grep "core/get-site-info" docs/abilities-api-assessment.md` returns a match.
Verify all 3 abilities listed: `grep -c "core/" docs/abilities-api-assessment.md` returns at least 3.
Verify gating strategy section: `grep -i "destructive" docs/abilities-api-assessment.md` returns matches.
Verify Gate surface list: `grep "admin.*ajax.*rest" docs/abilities-api-assessment.md` returns a match.
  </verify>
  <done>docs/abilities-api-assessment.md exists with all required sections: 3 read-only abilities inventory, permission_callback analysis, current Gate surface gap documentation, gating strategy for future destructive abilities, and recommendation of no changes for WP 7.0.</done>
</task>

</tasks>

<verification>
- `tests/MANUAL-TESTING.md` contains section 15 with 5 subsections
- `docs/abilities-api-assessment.md` exists with complete coverage per WP70-04
- No existing content in MANUAL-TESTING.md was modified (sections 1-14 unchanged)
- No code changes were made (this is documentation only)
</verification>

<success_criteria>
- Section 15 of MANUAL-TESTING.md provides clear visual check steps for all plugin UI surfaces under WP 7.0
- Abilities API assessment covers: current 3 read-only abilities, permission_callback pattern, when to add ability surface type to Gate
- Both documents are ready for human review and use
</success_criteria>

<output>
After completion, create `.planning/phases/05-wp-7-0-readiness/05-01-SUMMARY.md`
</output>
